// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

// ğŸ”¥ æ ¸å¿ƒä¿®æ”¹ï¼šæ”¹ä¸º postgresql
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ==========================================
// 1. åŸæœ‰æ¨¡å—ï¼šæ’è¯¾ä¸åŸºç¡€è¯„ä»·
// ==========================================

// 1. æ•™æåº“ (Material Library) - ç®€æ˜“ç‰ˆ
model Material {
  id          String   @id @default(cuid())
  name        String   @unique // æ•™æåç§°
  description String?  // å¤‡æ³¨
  reports     Report[] // å…³è”ï¼šè¢«å“ªäº›æŠ¥å‘Šä½¿ç”¨äº†
  createdAt   DateTime @default(now())
}

// 2. è¯¾ç¨‹æ’æœŸè¡¨ (Class Session)
model ClassSession {
  id                  String   @id @map("_id") // å¯¹åº” Excel: ä¸»é”®ID
  // --- è®¡åˆ’ä¿¡æ¯ ---
  courseName          String
  bookingType         String?
  excelStatus         String?
  // --- æ—¶é—´ä¿¡æ¯ ---
  classTimeBJ         String?
  classTimeSaudi      DateTime
  // --- è€å¸ˆä¿¡æ¯ ---
  teacherId           String
  teacherName         String
  // --- å­¦ç”Ÿä¿¡æ¯ ---
  originalStudentName String
  studentId           String
  // --- å¤–éƒ¨ID ---
  talk51Id            String?
  merithubId          String?
  // --- å…³è” ---
  report              Report?
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
}

// 3. è¯„ä»·æŠ¥å‘Šè¡¨ (Report)
model Report {
  id                   String       @id @default(cuid())
  // å…³è”è¯¾ç¨‹æ’æœŸ
  classSession         ClassSession @relation(fields: [sessionId], references: [id])
  sessionId            String       @unique
  // --- å®é™…å‘ç”Ÿçš„æ•°æ® ---
  actualStudentName    String
  // å®é™…ä½¿ç”¨çš„æ•™æ (ç®€æ˜“ç‰ˆå…³è”)
  material             Material?    @relation(fields: [materialId], references: [id])
  materialId           String?
  fallbackMaterialName String?
  // --- è¯„ä»·å†…å®¹ ---
  // å­˜å‚¨ JSON å­—ç¬¦ä¸²
  scores               String 
  feedback             String
  createdAt            DateTime     @default(now())
}

// ==========================================
// 4. æ–°å¢æ¨¡å—ï¼šæ·±åº¦æ•™æç®¡ç† (Excelä¸Šä¼ ç‰ˆ)
// ==========================================

model Textbook {
  id           String                    @id @default(cuid())
  bookId       String                    @unique // Excel Sheet 1 ä¸­çš„å”¯ä¸€ç¼–ç 
  name         String
  type         String // EXAM | SPEAKING
  coverUrl     String?
  
  // å…³è”å­è¡¨
  questions    TextbookQuestion[]
  modules      TextbookKnowledgeModule[]
  growthRules  TextbookGrowthRule[]
  commentRules TextbookCommentRule[]

  createdAt    DateTime                  @default(now())
  updatedAt    DateTime                  @updatedAt
}

model TextbookQuestion {
  id         String   @id @default(cuid())
  textbookId String
  textbook   Textbook @relation(fields: [textbookId], references: [id], onDelete: Cascade)

  qId        String // Excel ä¸­çš„é¢˜ç›®ID
  content    String // é¢˜ç›®å†…å®¹ (è‹±æ–‡)
  content_ar String? // é¢˜ç›®å†…å®¹ (é˜¿æ‹‰ä¼¯è¯­)
  
  qType      String // 'RADAR', 'Growth_Trigger', 'Comment_Trigger', 'CHOICE'
  tag        String? // å…³è”ç»´åº¦

  options    String? // å­˜å‚¨ JSON å­—ç¬¦ä¸² { A: "...", B: "..." }
  
  sortOrder  Int
}

model TextbookKnowledgeModule {
  id         String   @id @default(cuid())
  textbookId String
  textbook   Textbook @relation(fields: [textbookId], references: [id], onDelete: Cascade)

  title      String // æ¨¡å—æ ‡é¢˜ (è‹±æ–‡)
  title_ar   String? // æ¨¡å—æ ‡é¢˜ (é˜¿æ‹‰ä¼¯è¯­)
  
  content    String // å­˜å‚¨ JSON å­—ç¬¦ä¸² (è‹±æ–‡å†…å®¹æ•°ç»„)
  content_ar String? // å­˜å‚¨ JSON å­—ç¬¦ä¸² (é˜¿æ‹‰ä¼¯è¯­å†…å®¹æ•°ç»„)
  
  sortOrder  Int
}

model TextbookGrowthRule {
  id             String   @id @default(cuid())
  textbookId     String
  textbook       Textbook @relation(fields: [textbookId], references: [id], onDelete: Cascade)

  triggerKey     String // å¯¹åº”é€‰é¡¹ Key (A/B/C)
  stageName      String // é˜¶æ®µåç§° (è‹±æ–‡)
  stageName_ar   String? // é˜¶æ®µåç§° (é˜¿æ‹‰ä¼¯è¯­)
  
  displayText    String // æŠ¥å‘Šå±•ç¤ºæ–‡æ¡ˆ (è‹±æ–‡)
  displayText_ar String? // æŠ¥å‘Šå±•ç¤ºæ–‡æ¡ˆ (é˜¿æ‹‰ä¼¯è¯­)
  
  position       Int // åæ ‡ç‚¹
}

model TextbookCommentRule {
  id          String   @id @default(cuid())
  textbookId  String
  textbook    Textbook @relation(fields: [textbookId], references: [id], onDelete: Cascade)

  triggerKey  String // å¯¹åº”é€‰é¡¹ Key (A/B/C)
  summary     String? // ç®€è¿°
  
  fullText    String // å®Œæ•´è¯„è¯­ (è‹±æ–‡)
  fullText_ar String? // å®Œæ•´è¯„è¯­ (é˜¿æ‹‰ä¼¯è¯­)
}